# DA_monitor_websocket
用于网络硬件状态监测

## 功能需求
自主研发的AWG设备具有定时向外发送设备工作状态的功能。发送方式是通过UDP协议周期性向外输出1024字节二进制数据，端口是6789. 在一个大系统中会有1~数百个类似的设备同时工作在同一个局域网。要求设计一个监视系统，能实时接收所有设备的状态信息并解析成用户友好识别的方式。
1. 由于研发设计的不确定性，设备向外广播的1024字节数据中每一个比特的含义随时可能改变，具体表示多少个含义可能改变；
2. 监视系统至少具备提醒功能，对用户想高亮显示的状态提供支持；
3. 监视系统可能需要长时间运行，多用户同时进行监视。

## 主体实现
功能需求进一步明确：
1. 使用web服务器的方式，集中接收并处理所有硬件设备的数据
1.1 数据的解析通过json格式的配置文件控制，即对收到的数据根据json配置文件进行解析。这样的好处是将监视原始数据的产生与监视系统的设计人员分离开，原始数据生产者（监视需求方）与监视系统开发者只许定义好json配置文件的格式即可。监视系统开发者后期可以完全不关心监视原始数据的改变和监视显示改变。
1.2 数据只在有客户端存在时才接收并处理监视数据，减少无监视客户存在时的空耗
2. web服务器启动服务后，等待客户端接入，将实时监视数据发送给接入的客户端网页
3. 客户端网页刷新并显示监视数据
3.1 网页自适应监视数据条目的变化
3.2 网页根据条目中的颜色参数显示不同硬件状态的颜色
4. 提供模拟假数据监视功能，在没有实际硬件设备的情况下，使用模拟设备进行监视

## 实现方法
方法1：
参考网络上bottle框架

1.服务端启动服务
2.当客户端网页输入访问地址时，首先返回索引页。索引页中实现websocket client连接和响应，响应数据也在索引页中显示和刷新。
3.服务端发现有websocket client连接请求时，增加当前用户列表，在握手完成后即读取硬件状态信息，处理并发送给所有客户端
4.读取硬件信息函数只在当前存在客户端时才进行

该方法缺陷：
bottle框架无法支持多线程，使得该方案的实现中，同时只能有一个客户端能访问，其他客户端会被阻塞

方法2：
参考网络上tornado框架

tornado 框架支持多线程的方式
1.服务端启动服务
2.当客户端网页输入访问地址时，首先返回索引页。索引页中实现websocket client连接和响应，响应数据也在索引页中显示和刷新。
3.服务端发现有websocket client连接请求时，增加当前用户列表。在握手完成后，等待接收客户端发送的信息，然后将信息发送给除信源外的所有客户端；
4.启动一个无网页版的客户端，不停的接收并处理硬件状态数据，然后通过websocket 方式发送给服务端。

相对于bottle框架实现的方案，该方案的优点：
1. 支持多个客户端同时访问
2. 服务端设计简化，只关心消息的接收与转发，更容易实现通用化
3. 硬件状态的接收处理独立，更容易实现设计任务的分离

## 安装指南

## 最终效果

## 参考资料

